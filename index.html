<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaxy Explorer 3D</title>
    
    <!-- –ú–µ—Ç–∞-—Ç–µ–≥–∏ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö MIME-—Ç–∏–ø–æ–≤ -->
    <meta http-equiv="Content-Security-Policy" 
          content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.bioapgreid.ru; 
                   script-src 'self' 'unsafe-inline' 'unsafe-eval'; 
                   style-src 'self' 'unsafe-inline';">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <link rel="manifest" href="/web-app-manifest.json" type="application/manifest+json">
    
    <style>
        /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
        body { 
            margin: 0; 
            padding: 0; 
            background: #0c0c2e;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }
        
        #app-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0c0c2e;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 1000;
        }
        
        .error-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0c0c2e;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="app-container">
        <div class="loading-screen" id="loading-screen">
            <h1>üöÄ Galaxy Explorer 3D</h1>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—Å–º–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞...</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
        </div>
        
        <canvas id="galaxy-canvas"></canvas>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å —è–≤–Ω—ã–º —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–∏–ø–∞ -->
    <script type="module">
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π
        window.addEventListener('error', function(e) {
            if (e.target.tagName === 'SCRIPT' && e.target.type === 'module') {
                console.error('Module loading error:', e.error);
                showErrorScreen(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª—è: ${e.target.src}`);
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–Ω—ã—Ö –æ–±–µ—â–∞–Ω–∏–π
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled promise rejection:', e.reason);
            showErrorScreen(`–û—à–∏–±–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: ${e.reason.message}`);
        });

        function showErrorScreen(message) {
            const loadingScreen = document.getElementById('loading-screen');
            loadingScreen.innerHTML = `
                <div class="error-screen">
                    <h2>üö® –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h2>
                    <p>${message}</p>
                    <div class="error-details">
                        <p><strong>–ü—É—Ç—å:</strong> ${window.location.href}</p>
                        <p><strong>–ë—Ä–∞—É–∑–µ—Ä:</strong> ${navigator.userAgent}</p>
                    </div>
                    <div class="error-actions">
                        <button onclick="location.reload()">üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
                        <button onclick="switchTo2DMode()">üì± 2D –†–µ–∂–∏–º</button>
                    </div>
                </div>
            `;
        }

        function switchTo2DMode() {
            // Fallback –Ω–∞ 2D –≤–µ—Ä—Å–∏—é
            window.location.href = '/2d-fallback.html';
        }

        // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        import('./app/core/app.js')
            .then(module => {
                // –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏
                document.getElementById('loading-screen').style.display = 'none';
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                const GalaxyApp = module.GalaxyApp || module.default;
                window.galaxyApp = new GalaxyApp();
            })
            .catch(error => {
                console.error('Failed to load main application:', error);
                showErrorScreen(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: ${error.message}`);
            });
    </script>
</body>
</html>
